This is the version 4 of the code.